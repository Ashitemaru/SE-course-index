# 小作业 API 文档

## 前置提示

本 API 文档中对响应正文字段的规定中将会多次出现下述表达：

```json
{
    // ...
    "info": "[Anything you want to write.]",
    // ...
}
```

这个字段的含义是，我们不会使用自动化工具 CI 检查 `info` 字段的内容，但我们会通过白盒检查确认后端返回给前端的信息是准确易懂的。

## GET `/api/all`

本 API 用于获取存储在数据库中的所有游戏记录的基本数据。

=== "请求"

    本 API 使用 GET 方法，且不需要携带任何参数。

=== "行为"

    后端收到请求后，应当首先判定请求所使用的方法是否为 GET。若否，则应当按照要求构建错误响应。

    随后，应当从数据库中读取所有游戏记录并按照要求构建响应。

    若中途抛出错误，则应当按照要求构建错误响应。

=== "响应"

    正确响应的状态码为 200 OK。响应的正文为 JSON，格式如下：

    ```json
    {
        "status": 0,
        "info": "[Anything you want to write.]",
        "boards": [
            {
                "id": 3,
                "name": "Double beehive",
                "createdAt": 1669320727646,
                "userName": "Ashitemaru",
            },
            // ...
        ],
    }
    ```

    这里 `boards` 字段是一个数组，数组中每一项都应该包含下述字段：

    - `id`。表示该游戏记录在数据库中的唯一标识符，应当为正整数
    - `name`。表示该游戏记录的名称，应当为非空字符串
    - `createdAt`。表示该游戏记录创建的时间，使用 UNIX 时间戳（毫秒）表示，应当为正整数
    - `userName`。表示该游戏创建者的用户名，应当为非空字符串

=== "错误"

    所有错误响应的正文均为 JSON，格式均为：

    ```json
    {
        "status": *,
        "info": "[Anything you want to write.]",
    }
    ```

    唯一的差别在于表示错误类型的数字类型字段 `status` 不同。下述该字段称为**错误码**。

    - 若请求使用了错误的方法，错误响应的状态码为 400 Bad Request，错误码为 `-1`
    - 若读取数据中途抛出错误，错误响应的状态码为 500 Internal Server Error，错误码为 `-2`

## GET `/api/board`

本 API 用于获取存储在数据库中指定 ID 的游戏记录。

=== "请求"

    本 API 使用 GET 方法，且需要携带下述参数：

    - `id`。表示请求的游戏记录 ID，应当为正整数

    携带请求参数后的 URL 类似于 `/api/board?id=2`。

=== "行为"

    后端收到请求后，应当首先判定请求所使用的方法是否为 GET 以及是否按要求携带参数。若否，则应当按照要求构建错误响应。

    随后，应当从数据库中读取相应 ID 的游戏记录并按照要求构建响应。

    若该 ID 对应的游戏记录不存在，则应当按照要求构建错误响应。

    若中途抛出其他错误，也应当按照要求构建错误响应。

=== "响应"

    正确响应的状态码为 200 OK。响应的正文为 JSON，格式如下：

    ```json
    {
        "status": 0,
        "info": "[Anything you want to write.]",
        "board":
            "00010001010000...",
        "boardName": "Double beehive",
        "userName": "Ashitemaru",
    }
    ```

    上述字段的说明为：

    - `board`。表示该游戏记录，应当为长度为 2500 的、仅含有 `0` 或者 `1` 的字符串
    - `boardName`。表示该游戏记录的名称，应当为非空字符串
    - `userName`。表示该游戏创建者的用户名，应当为非空字符串

=== "错误"

    所有错误响应的正文均为 JSON，格式均为：

    ```json
    {
        "status": *,
        "info": "[Anything you want to write.]",
    }
    ```

    唯一的差别在于表示错误类型的数字类型字段 `status` 不同。下述该字段称为**错误码**。

    - 若该 ID 对应的游戏记录不存在，错误响应的状态码为 404 Not Found，错误码为 `1`
    - 若请求使用了错误的方法，错误响应的状态码为 400 Bad Request，错误码为 `-1`
    - 若请求中携带的 `id` 参数缺失或者存在但并非是正整数，错误响应的状态码为 400 Bad Request，错误码为 `-2`
    - 若读取数据中途抛出错误，错误响应的状态码为 500 Internal Server Error，错误码为 `-3`

## PUT `/api/add`

本 API 用于在数据库中新增游戏记录。但是考虑到数据库中对字段唯一性的要求，本接口也有可能仅更新存储在数据库中的游戏记录而不新增游戏记录。

=== "请求"

    本 API 使用 PUT 方法，且需要携带 JSON 格式正文：

    ```json
    {
        "board":
            "00010001010000...",
        "boardName": "Double beehive",
        "userName": "Ashitemaru",
    }
    ```

    - `board`。表示该游戏记录，应当为长度为 2500 的、仅含有 `0` 或者 `1` 的字符串
    - `boardName`。表示该游戏记录的名称，应当为非空字符串
    - `userName`。表示该游戏创建者的用户名，应当为非空字符串

=== "行为"

    后端收到请求后，应当首先判定请求所使用的方法是否为 PUT 以及是否按要求携带 JSON 格式正文。若否，则应当按照要求构建错误响应。

    在具体新增记录时，首先应当根据 `boardName` 和 `userName` 的唯一性要求查找是否存在已有游戏记录。若找到，则应当更新该记录并按照要求构建响应。若无法找到，则应当新建游戏记录并按照要求构建响应。

    若中途抛出其他错误，也应当按照要求构建错误响应。

=== "响应"

    所有正确响应的状态码均为 200 OK，正文均为 JSON，格式均为：

    ```json
    {
        "status": *,
        "info": "[Anything you want to write.]",
    }
    ```

    唯一的差别在于表示操作类型的数字类型字段 `status` 不同。下述该字段称为**提示码**。

    - 若新建了游戏记录，提示码为 `0`
    - 若未新建游戏记录，仅仅更新了游戏记录，提示码为 `1`

=== "错误"

    所有错误响应的正文均为 JSON，格式均为：

    ```json
    {
        "status": *,
        "info": "[Anything you want to write.]",
    }
    ```

    唯一的差别在于表示错误类型的数字类型字段 `status` 不同。下述该字段称为**错误码**。

    - 若请求使用了错误的方法，错误响应的状态码为 400 Bad Request，错误码为 `-1`
    - 若请求的正文中携带的字段不满足约束，错误响应的状态码为 400 Bad Request，错误码为 `-2`
    - 若读写数据中途抛出错误，错误响应的状态码为 500 Internal Server Error，错误码为 `-3`


## DELETE `/api/remove`

本 API 用于删除存储在数据库中指定 ID 的游戏记录。

=== "请求"

    本 API 使用 DELETE 方法，且需要携带 JSON 格式正文：

    ```json
    {
        "id": 3,
    }
    ```

    - `id`。表示请求删除的游戏记录 ID，应当为正整数

=== "行为"

    后端收到请求后，应当首先判定请求所使用的方法是否为 DELETE 以及是否按要求携带 JSON 格式正文。若否，则应当按照要求构建错误响应。

    随后，应当从数据库中删除相应 ID 的游戏记录并按照要求构建响应。

    若该 ID 对应的游戏记录不存在，则应当按照要求构建错误响应。

    若中途抛出其他错误，也应当按照要求构建错误响应。

=== "响应"

    正确响应的状态码为 200 OK。响应的正文为 JSON，格式如下：

    ```json
    {
        "status": 0,
        "info": "[Anything you want to write.]",
    }
    ```

=== "错误"

    所有错误响应的正文均为 JSON，格式均为：

    ```json
    {
        "status": *,
        "info": "[Anything you want to write.]",
    }
    ```

    唯一的差别在于表示错误类型的数字类型字段 `status` 不同。下述该字段称为**错误码**。

    - 若该 ID 对应的游戏记录不存在，错误响应的状态码为 404 Not Found，错误码为 `1`
    - 若请求使用了错误的方法，错误响应的状态码为 400 Bad Request，错误码为 `-1`
    - 若请求的正文中携带的 `id` 字段缺失或者存在但并非是正整数，错误响应的状态码为 400 Bad Request，错误码为 `-2`
    - 若读写数据中途抛出错误，错误响应的状态码为 500 Internal Server Error，错误码为 `-3`

## POST `/api/update`

本 API 用于更新存储在数据库中指定 ID 的游戏记录。

=== "请求"

    本 API 使用 POST 方法，且需要携带 JSON 格式正文：

    ```json
    {
        "id": 3,
        "board":
            "00010001010000...",
        "boardName": "Double beehive",
        "userName": "Ashitemaru",
    }
    ```

    - `id`。表示请求更新的游戏记录 ID，应当为正整数
    - `board`。表示该游戏记录，应当为长度为 2500 的、仅含有 `0` 或者 `1` 的字符串
    - `boardName`。表示该游戏记录的名称，应当为非空字符串
    - `userName`。表示该游戏创建者的用户名，应当为非空字符串

=== "行为"

    后端收到请求后，应当首先判定请求所使用的方法是否为 POST 以及是否按要求携带 JSON 格式正文。若否，则应当按照要求构建错误响应。

    若该 ID 对应的游戏记录不存在，则应当按照要求构建错误响应。
    
    若该 ID 对应的游戏记录存在但不满足 `boardName` 和 `userName` 的唯一性要求，也应当按照要求构建错误响应。
    
    其余情况下，应当更新游戏记录并按照要求构建响应。

    若中途抛出其他错误，也应当按照要求构建错误响应。

=== "响应"

    正确响应的状态码为 200 OK。响应的正文为 JSON，格式如下：

    ```json
    {
        "status": 0,
        "info": "[Anything you want to write.]",
    }
    ```

=== "错误"

    所有错误响应的正文均为 JSON，格式均为：

    ```json
    {
        "status": *,
        "info": "[Anything you want to write.]",
    }
    ```

    唯一的差别在于表示错误类型的数字类型字段 `status` 不同。下述该字段称为**错误码**。

    - 若 ID 对应的游戏记录存在，但在更新时因 `boardName` 和 `userName` 的唯一性要求失败，错误响应的状态码为 400 Bad Request，错误码为 `2`
    - 若 ID 对应的游戏记录不存在，错误响应的状态码为 404 Not Found，错误码为 `1`
    - 若请求使用了错误的方法，错误响应的状态码为 400 Bad Request，错误码为 `-1`
    - 若请求的正文中携带的字段不满足约束，错误响应的状态码为 400 Bad Request，错误码为 `-2`
    - 若读写数据中途抛出错误，错误响应的状态码为 500 Internal Server Error，错误码为 `-3`
