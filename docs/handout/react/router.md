# 切换页面 & 网络请求

## 实验目的

通过本 Step，我们希望你能够掌握如何在 Next.js 框架中设置页面路由和跳转以及通过 Axios 库完成网络请求，从而基本完成游戏记录列表页面。

## 实验步骤

首先你需要理解 Next.js 框架中如何管理页面路由，以及简单了解如何使用 `useRouter` Hook 来获取路由相关的基本信息以及实现页面跳转。此外，你需要在理解 JavaScript 的异步与 then 链语法的基础上，简单理解 Axios 库的使用方式，了解如何创建一个网络请求并按照 API 文档要求携带参数。

本 Step 需要你完成的是游戏记录列表页面，路径为 `/list`。我们已经在游戏主界面（路径为 `/`）底部写好了一个点击后能跳转到该页面的按钮，按钮上文字应当是 Go to full list。

之后，你需要在文件 `src/pages/list.tsx` 中的 `ListScreen` 组件内完成三处代码填空，分别是函数 `navigate, fetchList, deleteBoard`。

第一处，函数 `navigate` 用于处理页面顶端按钮的点击事件，用户点击后返回游戏主界面。本处填空的代码量在 5 行以内。

第二处，函数 `fetchList` 用于从后端拉取所有游戏记录构成的列表。该函数已经在 `useEffect` Hook 中调用（`useEffect` Hook 的使用后续讲解），用于在页面载入时拉取数据。本处填空的代码量在 20 行以内。

第三处，函数 `deleteBoard` 用于删除指定的游戏记录。本处填空的代码量在 20 行以内。

在完成填空后，游戏记录列表页面应当具有下述的交互：

- 页面加载完成后显示游戏记录的列表，若暂无游戏记录，则显示空列表提示文字
- 点击某个记录的 Play it 按钮可以跳转到 Replay Mode 的游戏主界面回放该记录（Replay Mode 的主界面已经为你实现好了）
- 点击某个记录的 Delete it 按钮可以删除该记录，需要有弹窗提示删除成功，删除成功后列表中该记录应当立刻消失
- 所有涉及到网络请求的部分，若请求失败应当有弹窗提示，弹窗提示文字亦可参考已有代码

完成本 Step 后，你的游戏主界面的交互应当和下述 GIF 图所展示的类似：

【TODO】

### 代码说明

我们已经在 `ListScreen` 组件内声明了 `refreshing, boardList` 两个组件状态，可以直接在此基础上完成你的代码。前者用于表示当前页面是否还在获取数据过程中，后者则用于存储列表页面用于展示的游戏记录。

另外，在文件 `src/utils/network.ts` 中我们已经定义了用于网络请求的 Axios 对象，并且在文件 `src/pages/index.tsx` 中 `saveBoard` 等函数中有已经编写好的通过 Axios 对象和 then 链语法完成的网络请求代码，可以参考这些代码完成本 Step。

【TODO：似乎还应该有一些前后端对接的指导】

## 实验评分

本 Step 总分为 20 分。

本 Step 采用人工评分。我们仅会**在通过 CI 检查的基础上**查看最后一次部署是否满足：

- （5 分）前后端通信正常
- （1 分）最初进入游戏记录列表页面时，首先显示加载中提示文字，之后显示空列表提示文字（因为最初数据库无记录）
- （4 分）点击退回到主界面按钮后，随机存储若干个游戏记录，再进入游戏记录列表页面后，能够显示出这些记录
- （2 分）点击某一条记录的 Play it 按钮能够正确跳转并回放该记录
- （8 分）点击某一条记录的 Delete it 按钮能够删除该记录，弹窗提示删除成功，关闭弹窗后该记录已经消失

我们会从第二项开始按顺序检查到最后一项，若均通过，则自动获得第一项的全部分数。否则，只要有一项不通过，则第一项计 0 分。

由于本 Step 涉及到网络请求，如果出现网络错误提示弹窗或者 5 秒内页面没有反应，我们会重试一次。若重试依然不成功则判定该功能点不得分。

## 知识讲解

由于本 Step 所涉及的技术要点基本都有成熟的文档介绍，这里直接引用参考文档链接。

首先你需要了解 Next.js 是通过 `pages` 目录下的目录结构管理路由的，具体的文档参见 [Next.js 官方文档相关页面](https://nextjs.org/docs/routing/introduction)。

关于路由，Next.js 定义了 `useRouter` Hook。其可以用于获取动态路由之中携带的参数（会在下一个 Step 中涉及）以及通过 `const router = useRouter(); router.push(...);` 的方式实现页面跳转。

之后你需要了解部分网络请求相关的知识。

最基本的 JS/TS 语言异步语法可以参考 [技能引导文档相关页面](https://docs.net9.org/languages/javascript/async/)。

函数组件中的网络请求往往需要使用 `useEffect` Hook 管理。`useEffect` Hook 的使用方法可以参考 [技能引导文档相关页面](https://docs.net9.org/frontend/react/function-component/#_3)。

本小作业框架使用 Axios 完成网络请求。Axios 的一个最小化使用示例见 [Axios 官方文档相关页面](https://axios-http.com/docs/example)，该示例足以支撑完成本 Step。Axios 更深入的知识可以自行学习。